var usersApp = angular.module("usersApp", []);
usersApp.controller('usersController',['$scope', '$http', 'popups', 'filters', 'control', function($scope, $http, popups, filters, control) {
    $scope.openProfile = function(profileBtn){
        popups.show('EditForm');
        control.fillProfile(profileBtn);
    }
    $scope.filterRateOrDate = function(){
        filters.showRateOrDate();
    }
    $scope.filterByRating = function(){
        filters.filterUserRate();
    }
    $scope.filterByDate = function(){
        filters.filterUserDate();
    }
	$scope.showAddForm = function(){popups.show('AddForm');}
    $scope.hideAddForm = function(){popups.hide('AddForm');}
    $scope.hideProfile = function(){popups.hide('EditForm');}
    $scope.refreshUsers = function(){
        $.get('http://localhost:4000/users').then(function(response) {
            $scope.users = {
                info: response
            };
        });
    }
    $scope.refreshUsers();
    $scope.editSubmitForm = function () {
        $scope.refreshUsers();
		control.submitEditForm('userEdit.$valid');
		$scope.refreshUsers();
    }
    $scope.addSubmitForm = function () {
        control.submitAddForm('userAdd.$valid');
        $scope.refreshUsers();
    }
    $scope.deleteUser = function(deleteBtn) {
        control.deleteUser(deleteBtn);
    }
    $scope.counter = 0;
    $scope.currentPage = 0;
    $scope.pageSize = 15;
    $scope.numberOfPages = function() {
    	if ($scope.users !== undefined) {
            return Math.ceil($scope.users.info.length / $scope.pageSize);
        }
	}
}]);


