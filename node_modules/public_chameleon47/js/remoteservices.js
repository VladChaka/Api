usersApp.service('remote', function (popups) {
    var self = this;
    self.sendAddForm = function(){
        $.post('http://localhost:4000/user/add', $('#add').serialize(), function(response) {
			if (response.error !== undefined) {
				if (response.error === "This login duplicate") {
					document.getElementsByClassName('add-login-used')[0].style.display = "block";
				} else if (response.error === "This email duplicate") {
					document.getElementsByClassName('add-email-used')[0].style.display = "block";
				}
			} else {
				popups.hide('AddForm');
			}
    	});
	}
	
	self.sendEditForm = function(id){
        $.post('http://localhost:4000/user/update/' + id, $('#userEdit').serialize(), function(response) {
            if (response.error !== undefined) {
                  if (response.error === "This email duplicate") {
                     document.getElementsByClassName('edit-email-used')[0].style.display = "block";
                  }
            } else {
                popups.hide('EditForm');
            }
         });
	}

	self.sendDeleteForm = function(id){
        $.post('http://localhost:4000/user/delete/' + id);
	}
	
	self.sendProfileForm = function(input, id){
        $.post('http://localhost:4000/user/' + id, $('#add').serialize(), function(response) {
			input[0].value = response._id;
			input[1].value = response.username;
			input[2].value = response.email;
			input[3].value = response.post;
			input[4].value = response.phone;
			input[5].value = response.password;
			input[6].value = response.fullname;
		});
    }

    self.submitEditForm = function(isValid) {
        if (isValid){
            document.getElementsByClassName('edit-email-used')[0].style.display = "none";
            var id = document.getElementById('userEdit').getElementsByTagName('input')[0].value;
            $.post('http://localhost:4000/user/update/' + id, $('#userEdit').serialize(), function(response) {
                if (response.error !== undefined) {
                    if (response.error === "This email duplicate") {
                        document.getElementsByClassName('edit-email-used')[0].style.display = "block";
                    }
                } else {
                    popups.hide('EditForm');
                }
            });
        };
    }
    self.deleteUser = function(deleteBtn) {
        var id = deleteBtn.parentNode.id;
        $.post('http://localhost:4000/user/delete/' + id);
        var deleted = deleteBtn.parentNode.parentNode.style.display= "none";
    }
    self.fillProfile = function (profileBtn) {
        var editForm = document.getElementById('EditForm'),
            input = editForm.getElementsByTagName("input"),
            id = profileBtn.parentNode.id;
        $.post('http://localhost:4000/user/' + id, $('#add').serialize(), function(response) {
            input[0].value = response._id;
            input[1].value = response.username;
            input[2].value = response.email;
            input[3].value = response.post;
            input[4].value = response.phone;
            input[5].value = response.password;
            input[6].value = response.fullname;
        });
    }
})