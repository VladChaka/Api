usersApp.service('popups', function () {
    var self = this;
    self.show = function (element) {
        document.getElementById(element).style.display = "flex";
        document.getElementById("popupsContainer").style.display = "flex";
        if (document.body.offsetHeight > window.innerHeight) {
            document.body.style.overflow = 'hidden';
            document.body.style.paddingRight = '15px';
        };
    };
    self.hide = function (element) {
        document.getElementById(element).style.display = "none";
        document.getElementById("popupsContainer").style.display = "none";
        document.body.style.overflow = 'auto';
        document.body.style.paddingRight = '0';
    };
});
usersApp.service('filters', function () {
    var self = this;
    var activeFilter = document.getElementsByClassName('filters-order-active');
    self.filterUserDate = function() {
        var rating = document.getElementsByClassName('list-user-rating');
        var date = document.getElementsByClassName('list-user-date');
        for (i = 0; i < rating.length; i++) {
            rating[i].style.display = "none";
        }
        for (i = 0; i < date.length; i++) {
            date[i].style.display = "block";
        }
        activeFilter[0].innerHTML = "By Date";
        self.showRateOrDate();
    }
    self.filterUserRate = function (){
        var rating = document.getElementsByClassName('list-user-rating');
        var date = document.getElementsByClassName('list-user-date');
        for (i = 0; i < date.length; i++) {
            date[i].style.display = "none";
        }
        for (i = 0; i < rating.length; i++) {
            rating[i].style.display = "block";
        }
        activeFilter[0].innerHTML = "By Rating";
        self.showRateOrDate();
    }
    self.showRateOrDate = function() {
        var toggle = document.getElementById("orderPopup").style.display;
        if (toggle == "none") {
            document.getElementById("orderPopup").style.display = "flex";
        } else {
            document.getElementById("orderPopup").style.display = "none";
        }
    }
})

usersApp.service('control', ['popups', 'remote', function (popups, remote) {
    var self = this;
    self.submitAddForm = function(isValid){
        if (isValid){
            document.getElementsByClassName('add-login-used')[0].style.display = "none";
            document.getElementsByClassName('add-email-used')[0].style.display = "none";
            console.log($.post('http://localhost:4000/user/add', $('#add').serialize(), function(response) {
                return response;
            }));
        };
    };

    self.submitEditForm = function(isValid) {
        if (isValid){
            document.getElementsByClassName('edit-email-used')[0].style.display = "none";
            var id = document.getElementById('userEdit').getElementsByTagName('input')[0].value;
            $.post('http://localhost:4000/user/update/' + id, $('#userEdit').serialize(), function(response) {
                if (response.error !== undefined) {
                    if (response.error === "This email duplicate") {
                        document.getElementsByClassName('edit-email-used')[0].style.display = "block";
                    }
                } else {
                    popups.hide('EditForm');
                }
            });
        };
    }
    self.deleteUser = function(deleteBtn) {
        var id = deleteBtn.parentNode.id;
        $.post('http://localhost:4000/user/delete/' + id);
        var deleted = deleteBtn.parentNode.parentNode.style.display= "none";
    }
    self.fillProfile = function (profileBtn) {
        var editForm = document.getElementById('EditForm'),
            input = editForm.getElementsByTagName("input"),
			id = profileBtn.parentNode.id;
		$.post('http://localhost:4000/user/' + id, $('#add').serialize(), function(response) {
			input[0].value = response._id;
			input[1].value = response.username;
			input[2].value = response.email;
			input[3].value = response.post;
			input[4].value = response.phone;
			input[5].value = response.password;
			input[6].value = response.fullname;
		});
    }
}])