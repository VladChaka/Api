var usersApp = angular.module("usersApp", ['ngResource']);

usersApp.controller('usersController', ['$scope', 'popups', 'filters', 'control', 'refreshUsers', function($scope, popups, filters, control, refreshUsers) {
    $scope.refreshUsers = function(){
		refreshUsers.query().$promise.then(function(user) {
			$scope.users = {
				info: user
			};
    })};
    $scope.refreshUsers();
    $scope.addSubmitForm = function() {
        control.submitAddForm('userAdd.$valid');
        $scope.refreshUsers();
    }

    $scope.deleteUser = function(deleteBtn) {
        control.deleteUser(deleteBtn);
    }
    $scope.openProfile = function(profileBtn) {
        popups.show('EditForm');
        control.fillProfile(profileBtn);
    }
    $scope.filterRateOrDate = function() {
        filters.showRateOrDate();
    }
    $scope.filterByRating = function() {
        filters.filterUserRate();
    }
    $scope.filterByDate = function() {
        filters.filterUserDate();
    }
    $scope.showAddForm = function() { popups.show('AddForm'); }
    $scope.hideAddForm = function() { popups.hide('AddForm'); }
    $scope.hideProfile = function() { popups.hide('EditForm'); }

    $scope.editSubmitForm = function() {
        control.submitEditForm('userEdit.$valid');
        $scope.refreshUsers();
    }
    $scope.counter = 0;
    $scope.currentPage = 0;
    $scope.pageSize = 15;
    $scope.numberOfPages = function() {
        if ($scope.users !== undefined) {
            return Math.ceil($scope.users.info.length / $scope.pageSize);
        }
    }
}]);